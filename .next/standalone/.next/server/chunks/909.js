"use strict";exports.id=909,exports.ids=[909],exports.modules={12909:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.d(t,{N:()=>c});var i=a(13581),o=a(85663),d=a(71682),r=a(32767),l=a(94634),u=e([d]);d=(u.then?(await u)():u)[0];let c={session:{strategy:"jwt"},pages:{signIn:"/auth/login",signOut:"/auth/logout",error:"/auth/error"},providers:[(0,i.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await d.db.select().from(r.users).where((0,l.eq)(r.users.email,e.email)).limit(1);return t[0]&&t[0].isActive&&await (0,o.UD)(e.password,t[0].passwordHash)?(await d.db.update(r.users).set({lastLogin:new Date}).where((0,l.eq)(r.users.id,t[0].id)),{id:t[0].id,email:t[0].email,name:`${t[0].firstName} ${t[0].lastName}`,role:t[0].role||"user",organizationId:t[0].organizationId||void 0}):null}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.userId=t.id,e.email=t.email,e.name=t.name,e.role=t.role,e.organizationId=t.organizationId),e),session:async({session:e,token:t})=>(t&&(e.user={id:t.userId,email:t.email,name:t.name,role:t.role,organizationId:t.organizationId}),e)},secret:process.env.NEXTAUTH_SECRET};n()}catch(e){n(e)}})},32767:(e,t,a)=>{a.r(t),a.d(t,{accountTypeEnum:()=>y,accounts:()=>x,accountsRelations:()=>F,auditActionEnum:()=>I,auditLogs:()=>G,bankTransactionTypeEnum:()=>v,bankTransactions:()=>M,billLineItems:()=>Q,billStatusEnum:()=>z,bills:()=>C,contactTypeEnum:()=>g,contacts:()=>T,contactsRelations:()=>O,expenseClaimLines:()=>S,expenseClaims:()=>P,expenseStatusEnum:()=>b,invoiceLineItems:()=>j,invoiceLineItemsRelations:()=>$,invoiceStatusEnum:()=>R,invoices:()=>J,invoicesRelations:()=>V,itemTypeEnum:()=>w,items:()=>U,journalEntries:()=>L,journalEntryLines:()=>K,journalStatusEnum:()=>h,organizations:()=>A,organizationsRelations:()=>B,paymentAllocations:()=>D,payments:()=>k,taxRates:()=>q,taxTypeEnum:()=>N,users:()=>E,usersRelations:()=>H});var n=a(88544),i=a(64386),o=a(9594),d=a(79252),r=a(29334),l=a(63431),u=a(54693),c=a(9253),s=a(72170),m=a(89697),_=a(37193),f=a(34509),p=a(39783);let y=(0,n.rL)("account_type",["asset","liability","equity","revenue","expense"]),g=(0,n.rL)("contact_type",["customer","supplier","both"]),N=(0,n.rL)("tax_type",["sales","purchase","both"]),h=(0,n.rL)("journal_status",["draft","posted","reversed"]),R=(0,n.rL)("invoice_status",["draft","sent","paid","cancelled","overdue"]),z=(0,n.rL)("bill_status",["draft","approved","paid","cancelled","overdue"]),b=(0,n.rL)("expense_status",["draft","submitted","approved","paid","rejected"]),v=(0,n.rL)("bank_transaction_type",["debit","credit"]),w=(0,n.rL)("item_type",["product","service"]),I=(0,n.rL)("audit_action",["create","update","delete"]),A=(0,i.cJ)("organizations",{id:(0,o.uR)("id").defaultRandom().primaryKey(),name:(0,d.yf)("name",{length:255}).notNull(),legalName:(0,d.yf)("legal_name",{length:255}),taxNumber:(0,d.yf)("tax_number",{length:100}),registrationNumber:(0,d.yf)("registration_number",{length:100}),contactEmail:(0,d.yf)("contact_email",{length:255}),phone:(0,d.yf)("phone",{length:50}),address:(0,r.Qq)("address"),city:(0,d.yf)("city",{length:100}),state:(0,d.yf)("state",{length:100}),postalCode:(0,d.yf)("postal_code",{length:20}),country:(0,d.yf)("country",{length:100}),currencyCode:(0,d.yf)("currency_code",{length:3}).default("USD"),timezone:(0,d.yf)("timezone",{length:50}).default("UTC"),fiscalYearStartMonth:(0,l.nd)("fiscal_year_start_month").default(1),isActive:(0,u.zM)("is_active").default(!0),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()}),E=(0,i.cJ)("users",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),firstName:(0,d.yf)("first_name",{length:100}).notNull(),lastName:(0,d.yf)("last_name",{length:100}).notNull(),email:(0,d.yf)("email",{length:255}).unique().notNull(),passwordHash:(0,d.yf)("password_hash",{length:255}).notNull(),role:(0,d.yf)("role",{length:50}).default("user"),isActive:(0,u.zM)("is_active").default(!0),lastLogin:(0,c.vE)("last_login",{withTimezone:!0}),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()}),x=(0,i.cJ)("accounts",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),code:(0,d.yf)("code",{length:50}).notNull(),name:(0,d.yf)("name",{length:255}).notNull(),type:y("type").notNull(),parentAccountId:(0,o.uR)("parent_account_id"),isBankAccount:(0,u.zM)("is_bank_account").default(!1),isActive:(0,u.zM)("is_active").default(!0),taxRateId:(0,o.uR)("tax_rate_id"),description:(0,r.Qq)("description"),balance:(0,s._)("balance",{precision:15,scale:2}).default("0.00"),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()},e=>({orgCodeUnique:(0,m.GL)("accounts_org_code_unique").on(e.organizationId,e.code)})),T=(0,i.cJ)("contacts",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),type:g("type").notNull(),name:(0,d.yf)("name",{length:255}).notNull(),email:(0,d.yf)("email",{length:255}),phone:(0,d.yf)("phone",{length:50}),contactPerson:(0,d.yf)("contact_person",{length:255}),address:(0,r.Qq)("address"),city:(0,d.yf)("city",{length:100}),state:(0,d.yf)("state",{length:100}),postalCode:(0,d.yf)("postal_code",{length:20}),country:(0,d.yf)("country",{length:100}),taxNumber:(0,d.yf)("tax_number",{length:100}),paymentTerms:(0,l.nd)("payment_terms").default(30),creditLimit:(0,s._)("credit_limit",{precision:15,scale:2}),isActive:(0,u.zM)("is_active").default(!0),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()}),q=(0,i.cJ)("tax_rates",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),name:(0,d.yf)("name",{length:100}).notNull(),rate:(0,s._)("rate",{precision:8,scale:4}).notNull(),type:N("type").notNull(),isActive:(0,u.zM)("is_active").default(!0),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()}),L=(0,i.cJ)("journal_entries",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),entryNumber:(0,d.yf)("entry_number",{length:50}).notNull(),date:(0,_.p6)("date").notNull(),reference:(0,d.yf)("reference",{length:255}),description:(0,r.Qq)("description").notNull(),totalAmount:(0,s._)("total_amount",{precision:15,scale:2}).notNull(),status:h("status").default("posted"),createdBy:(0,o.uR)("created_by").references(()=>E.id),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()},e=>({orgEntryNumberUnique:(0,m.GL)("journal_entries_org_number_unique").on(e.organizationId,e.entryNumber)})),K=(0,i.cJ)("journal_entry_lines",{id:(0,o.uR)("id").defaultRandom().primaryKey(),journalEntryId:(0,o.uR)("journal_entry_id").references(()=>L.id,{onDelete:"cascade"}),accountId:(0,o.uR)("account_id").references(()=>x.id),debitAmount:(0,s._)("debit_amount",{precision:15,scale:2}).default("0.00"),creditAmount:(0,s._)("credit_amount",{precision:15,scale:2}).default("0.00"),description:(0,r.Qq)("description"),reference:(0,d.yf)("reference",{length:255}),contactId:(0,o.uR)("contact_id").references(()=>T.id),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow()}),J=(0,i.cJ)("invoices",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),invoiceNumber:(0,d.yf)("invoice_number",{length:50}).notNull(),contactId:(0,o.uR)("contact_id").references(()=>T.id),contactName:(0,d.yf)("contact_name",{length:255}),issueDate:(0,_.p6)("issue_date").notNull(),dueDate:(0,_.p6)("due_date").notNull(),status:R("status").default("draft"),subtotal:(0,s._)("subtotal",{precision:15,scale:2}).notNull().default("0.00"),taxAmount:(0,s._)("tax_amount",{precision:15,scale:2}).notNull().default("0.00"),total:(0,s._)("total",{precision:15,scale:2}).notNull().default("0.00"),paidAmount:(0,s._)("paid_amount",{precision:15,scale:2}).default("0.00"),notes:(0,r.Qq)("notes"),terms:(0,r.Qq)("terms"),templateId:(0,o.uR)("template_id"),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()},e=>({orgInvoiceNumberUnique:(0,m.GL)("invoices_org_number_unique").on(e.organizationId,e.invoiceNumber)})),j=(0,i.cJ)("invoice_line_items",{id:(0,o.uR)("id").defaultRandom().primaryKey(),invoiceId:(0,o.uR)("invoice_id").references(()=>J.id,{onDelete:"cascade"}),accountId:(0,o.uR)("account_id").references(()=>x.id),description:(0,r.Qq)("description").notNull(),quantity:(0,s._)("quantity",{precision:10,scale:2}).notNull(),unitPrice:(0,s._)("unit_price",{precision:15,scale:2}).notNull(),lineTotal:(0,s._)("line_total",{precision:15,scale:2}).notNull(),taxRateId:(0,o.uR)("tax_rate_id").references(()=>q.id),taxAmount:(0,s._)("tax_amount",{precision:15,scale:2}).default("0.00"),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow()}),C=(0,i.cJ)("bills",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),billNumber:(0,d.yf)("bill_number",{length:50}).notNull(),contactId:(0,o.uR)("contact_id").references(()=>T.id),contactName:(0,d.yf)("contact_name",{length:255}),issueDate:(0,_.p6)("issue_date").notNull(),dueDate:(0,_.p6)("due_date").notNull(),status:z("status").default("draft"),subtotal:(0,s._)("subtotal",{precision:15,scale:2}).notNull().default("0.00"),taxAmount:(0,s._)("tax_amount",{precision:15,scale:2}).notNull().default("0.00"),total:(0,s._)("total",{precision:15,scale:2}).notNull().default("0.00"),paidAmount:(0,s._)("paid_amount",{precision:15,scale:2}).default("0.00"),notes:(0,r.Qq)("notes"),reference:(0,d.yf)("reference",{length:255}),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()},e=>({orgBillNumberUnique:(0,m.GL)("bills_org_number_unique").on(e.organizationId,e.billNumber)})),Q=(0,i.cJ)("bill_line_items",{id:(0,o.uR)("id").defaultRandom().primaryKey(),billId:(0,o.uR)("bill_id").references(()=>C.id,{onDelete:"cascade"}),accountId:(0,o.uR)("account_id").references(()=>x.id),description:(0,r.Qq)("description").notNull(),quantity:(0,s._)("quantity",{precision:10,scale:2}).notNull(),unitPrice:(0,s._)("unit_price",{precision:15,scale:2}).notNull(),lineTotal:(0,s._)("line_total",{precision:15,scale:2}).notNull(),taxRateId:(0,o.uR)("tax_rate_id").references(()=>q.id),taxAmount:(0,s._)("tax_amount",{precision:15,scale:2}).default("0.00"),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow()}),k=(0,i.cJ)("payments",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),paymentNumber:(0,d.yf)("payment_number",{length:50}).notNull(),date:(0,_.p6)("date").notNull(),amount:(0,s._)("amount",{precision:15,scale:2}).notNull(),paymentMethod:(0,d.yf)("payment_method",{length:50}).notNull(),reference:(0,d.yf)("reference",{length:255}),bankAccountId:(0,o.uR)("bank_account_id").references(()=>x.id),contactId:(0,o.uR)("contact_id").references(()=>T.id),notes:(0,r.Qq)("notes"),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()},e=>({orgPaymentNumberUnique:(0,m.GL)("payments_org_number_unique").on(e.organizationId,e.paymentNumber)})),D=(0,i.cJ)("payment_allocations",{id:(0,o.uR)("id").defaultRandom().primaryKey(),paymentId:(0,o.uR)("payment_id").references(()=>k.id,{onDelete:"cascade"}),invoiceId:(0,o.uR)("invoice_id").references(()=>J.id),billId:(0,o.uR)("bill_id").references(()=>C.id),amount:(0,s._)("amount",{precision:15,scale:2}).notNull(),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow()}),M=(0,i.cJ)("bank_transactions",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),bankAccountId:(0,o.uR)("bank_account_id").references(()=>x.id),date:(0,_.p6)("date").notNull(),amount:(0,s._)("amount",{precision:15,scale:2}).notNull(),type:v("type").notNull(),description:(0,r.Qq)("description"),reference:(0,d.yf)("reference",{length:255}),payee:(0,d.yf)("payee",{length:255}),isReconciled:(0,u.zM)("is_reconciled").default(!1),contactId:(0,o.uR)("contact_id").references(()=>T.id),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()}),U=(0,i.cJ)("items",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),itemCode:(0,d.yf)("item_code",{length:50}).notNull(),name:(0,d.yf)("name",{length:255}).notNull(),description:(0,r.Qq)("description"),type:w("type").notNull(),unitPrice:(0,s._)("unit_price",{precision:15,scale:2}).notNull(),costPrice:(0,s._)("cost_price",{precision:15,scale:2}),quantityOnHand:(0,l.nd)("quantity_on_hand").default(0),salesAccountId:(0,o.uR)("sales_account_id").references(()=>x.id),purchaseAccountId:(0,o.uR)("purchase_account_id").references(()=>x.id),taxRateId:(0,o.uR)("tax_rate_id").references(()=>q.id),isActive:(0,u.zM)("is_active").default(!0),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()},e=>({orgItemCodeUnique:(0,m.GL)("items_org_code_unique").on(e.organizationId,e.itemCode)})),P=(0,i.cJ)("expense_claims",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),claimNumber:(0,d.yf)("claim_number",{length:50}).notNull(),userId:(0,o.uR)("user_id").references(()=>E.id),date:(0,_.p6)("date").notNull(),totalAmount:(0,s._)("total_amount",{precision:15,scale:2}).notNull(),status:b("status").default("draft"),notes:(0,r.Qq)("notes"),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow(),updatedAt:(0,c.vE)("updated_at",{withTimezone:!0}).defaultNow()},e=>({orgClaimNumberUnique:(0,m.GL)("expense_claims_org_number_unique").on(e.organizationId,e.claimNumber)})),S=(0,i.cJ)("expense_claim_lines",{id:(0,o.uR)("id").defaultRandom().primaryKey(),expenseClaimId:(0,o.uR)("expense_claim_id").references(()=>P.id,{onDelete:"cascade"}),accountId:(0,o.uR)("account_id").references(()=>x.id),date:(0,_.p6)("date").notNull(),amount:(0,s._)("amount",{precision:15,scale:2}).notNull(),description:(0,r.Qq)("description").notNull(),receiptReference:(0,d.yf)("receipt_reference",{length:255}),taxRateId:(0,o.uR)("tax_rate_id").references(()=>q.id),taxAmount:(0,s._)("tax_amount",{precision:15,scale:2}).default("0.00"),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow()}),G=(0,i.cJ)("audit_logs",{id:(0,o.uR)("id").defaultRandom().primaryKey(),organizationId:(0,o.uR)("organization_id").references(()=>A.id),userId:(0,o.uR)("user_id").references(()=>E.id),tableName:(0,d.yf)("table_name",{length:100}).notNull(),recordId:(0,o.uR)("record_id").notNull(),action:I("action").notNull(),oldValues:(0,f.Fx)("old_values"),newValues:(0,f.Fx)("new_values"),createdAt:(0,c.vE)("created_at",{withTimezone:!0}).defaultNow()},e=>({orgTableRecordIdx:(0,m.Pe)("audit_logs_org_table_record_idx").on(e.organizationId,e.tableName,e.recordId)})),B=(0,p.K1)(A,({many:e})=>({users:e(E),accounts:e(x),contacts:e(T),taxRates:e(q),journalEntries:e(L),invoices:e(J),bills:e(C),payments:e(k),bankTransactions:e(M),items:e(U),expenseClaims:e(P),auditLogs:e(G)})),H=(0,p.K1)(E,({one:e,many:t})=>({organization:e(A,{fields:[E.organizationId],references:[A.id]}),journalEntries:t(L),expenseClaims:t(P),auditLogs:t(G)})),F=(0,p.K1)(x,({one:e,many:t})=>({organization:e(A,{fields:[x.organizationId],references:[A.id]}),parentAccount:e(x,{fields:[x.parentAccountId],references:[x.id]}),childAccounts:t(x),journalEntryLines:t(K),invoiceLineItems:t(j),billLineItems:t(Q),payments:t(k),bankTransactions:t(M),salesItems:t(U),purchaseItems:t(U),expenseClaimLines:t(S)})),O=(0,p.K1)(T,({one:e,many:t})=>({organization:e(A,{fields:[T.organizationId],references:[A.id]}),invoices:t(J),bills:t(C),payments:t(k),bankTransactions:t(M),journalEntryLines:t(K)})),V=(0,p.K1)(J,({one:e,many:t})=>({organization:e(A,{fields:[J.organizationId],references:[A.id]}),contact:e(T,{fields:[J.contactId],references:[T.id]}),lineItems:t(j),paymentAllocations:t(D)})),$=(0,p.K1)(j,({one:e})=>({invoice:e(J,{fields:[j.invoiceId],references:[J.id]}),account:e(x,{fields:[j.accountId],references:[x.id]}),taxRate:e(q,{fields:[j.taxRateId],references:[q.id]})}))},71682:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.d(t,{db:()=>u});var i=a(72094),o=a(64939),d=a(32767),r=e([o,i]);[o,i]=r.then?(await r)():r;let l=new o.Pool({connectionString:process.env.DATABASE_URL,max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3}),u=(0,i.fd)(l,{schema:d});n()}catch(e){n(e)}})}};